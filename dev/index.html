<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cozy Voxel Farm â€” Smooth Camera Edition</title>
<style>
  html,body{height:100%;margin:0;overflow:hidden;font-family:system-ui,Segoe UI,Roboto}
  #ui{position:fixed;left:12px;top:12px;z-index:30;background:rgba(255,255,255,0.9);padding:10px;border-radius:10px;backdrop-filter:blur(4px);box-shadow:0 6px 18px rgba(0,0,0,0.12)}
  #ui small{color:#555}
  #hud{position:fixed;right:12px;top:12px;z-index:30;color:#111;background:rgba(255,255,255,0.85);padding:10px;border-radius:10px}
  canvas{display:block}
  button{padding:6px 10px;border-radius:6px;border:1px solid #ccc;background:#fff}
</style>
</head>
<body>
<div id="ui">
  <div style="font-weight:700">Cozy Voxel Farm â€” Smooth Camera</div>
  <div style="font-size:13px;margin-top:6px">WASD - poruszanie | Mysz - rozglÄ…danie | LPM - akcja | PPM - sadÅº/usuÅ„ | R - reset | P/L - zapisz/wczytaj</div>
  <div style="height:6px"></div>
  <div>ðŸŒ¾ <span id="ui-seeds">0</span>  ðŸ’§ <span id="ui-water">0</span>  ðŸ”‹ <span id="ui-stamina">100</span></div>
  <div style="margin-top:6px"><small>Tekstury: proceduralne (styl voxel CC0).</small></div>
</div>
<div id="hud"></div>
<script>
// --- Smooth Minecraft-like camera & movement ---
const THREE_CDN = 'https://unpkg.com/three@0.155.0/build/three.min.js';
function loadScript(url){return new Promise((res,reject)=>{const s=document.createElement('script');s.src=url;s.onload=res;s.onerror=reject;document.head.appendChild(s)})}

(async function(){
  await loadScript(THREE_CDN);
  const THREE = window.THREE;
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 2000);
  camera.position.set(0, 2, 8);
  const renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth, innerHeight); renderer.setPixelRatio(window.devicePixelRatio||1);
  document.body.appendChild(renderer.domElement);

  const sun = new THREE.DirectionalLight(0xffffff,1.0); sun.position.set(5,10,2); scene.add(sun);
  const amb = new THREE.HemisphereLight(0x88bbff,0x664422,0.6); scene.add(amb);

  function noise(x,y,seed=0){return (Math.abs(Math.sin((x*12.9898+y*78.233+seed)*43758.5453))%1)}
  function makeTile(colorFunc,size=32){const c=document.createElement('canvas');c.width=c.height=size;const g=c.getContext('2d');const img=g.createImageData(size,size);for(let y=0;y<size;y++)for(let x=0;x<size;x++){const i=(y*size+x)*4;const col=colorFunc(x,y,size);img.data[i]=col[0];img.data[i+1]=col[1];img.data[i+2]=col[2];img.data[i+3]=255;}g.putImageData(img,0,0);return new THREE.CanvasTexture(c);}
  const texGrass = makeTile((x,y)=>[34,150+noise(x,y,3)*60,45+noise(x,y,7)*20],64);
  const texDirt = makeTile((x,y)=>{const v=90+noise(x,y,5)*40;return [v-10,v-30,v-30]},64);
  const texWater = makeTile((x,y)=>{const v=120+noise(x,y,9)*80;return [30,80,v]},64);
  [texGrass,texDirt,texWater].forEach(t=>{t.magFilter=THREE.NearestFilter;t.minFilter=THREE.NearestMipmapNearestFilter});

  const MAP=24; const blocks=new Int8Array(MAP*MAP);
  for(let x=0;x<MAP;x++)for(let z=0;z<MAP;z++){const i=x+z*MAP;blocks[i]=1;if(x>9&&x<13&&z>3&&z<10)blocks[i]=4;if(x>4&&x<12&&z>8&&z<16)blocks[i]=2;}

  const cubeGeo=new THREE.BoxGeometry(1,1,1);
  const mats={1:new THREE.MeshLambertMaterial({map:texGrass}),2:new THREE.MeshLambertMaterial({map:texDirt}),4:new THREE.MeshLambertMaterial({map:texWater,transparent:true,opacity:0.8})};
  const world=new THREE.Group();scene.add(world);
  for(let x=0;x<MAP;x++)for(let z=0;z<MAP;z++){const i=x+z*MAP;if(blocks[i]){const m=new THREE.Mesh(cubeGeo,mats[blocks[i]]);m.position.set(x-MAP/2+0.5,0.5,z-MAP/2+0.5);world.add(m);}}

  const player={pos:new THREE.Vector3(0,2,8),vel:new THREE.Vector3(),yaw:0,pitch:0,seeds:8,water:5,stamina:100};
  const keys={};window.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);window.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

  // pointer lock & camera control
  let locked=false;renderer.domElement.addEventListener('click',()=>{renderer.domElement.requestPointerLock()});document.addEventListener('pointerlockchange',()=>locked=document.pointerLockElement===renderer.domElement);
  document.addEventListener('mousemove',e=>{if(!locked)return;player.yaw-=e.movementX*0.002;player.pitch-=e.movementY*0.002;player.pitch=Math.max(-Math.PI/2+0.1,Math.min(Math.PI/2-0.1,player.pitch));});

  function updateMovement(dt){
    const dir=new THREE.Vector3();
    if(keys['w'])dir.z-=1;if(keys['s'])dir.z+=1;if(keys['a'])dir.x-=1;if(keys['d'])dir.x+=1;dir.normalize();
    const speed=5;const rotMat=new THREE.Matrix4().makeRotationY(player.yaw);
    dir.applyMatrix4(rotMat);
    player.pos.addScaledVector(dir,speed*dt);
  }

  // smooth camera follow & head bob
  let bobTime=0;function updateCamera(dt){bobTime+=dt*6;const headBob=keys['w']||keys['a']||keys['s']||keys['d']?Math.sin(bobTime)*0.05:0;const target=new THREE.Vector3(player.pos.x,player.pos.y+1.5+headBob,player.pos.z);camera.position.lerp(target,0.15);camera.rotation.order='YXZ';camera.rotation.y=player.yaw;camera.rotation.x=player.pitch;}

  const uiSeeds=document.getElementById('ui-seeds');const uiWater=document.getElementById('ui-water');const uiStam=document.getElementById('ui-stamina');
  function updateUI(){uiSeeds.textContent=player.seeds;uiWater.textContent=player.water;uiStam.textContent=Math.round(player.stamina);}

  let prev=performance.now();function loop(){const now=performance.now();const dt=(now-prev)/1000;prev=now;updateMovement(dt);updateCamera(dt);renderer.render(scene,camera);requestAnimationFrame(loop);}loop();
})();
</script>
</body>
</html>
